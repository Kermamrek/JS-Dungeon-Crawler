<html>
	<head>
		<title>Dungeon Crawler</title>
		<style>
			body 
			{ 
				margin: 0px; 
			}
			#game
			{
				overflow: hidden;
				height: 100%;
			}
			#options
			{
				padding-left: 3px;
				float: right;
				width: 150px;
				height: 100%;
				color: white;
				background-color:#132538;
			}
		</style>
	</head>
	<body>
		<div id = "options">
			options and stuff would go here
		</div>
		<div id = "game"></div>
		<script src='./THREE/three.min.js'></script>
		<script src='./THREE/THREEx.KeyboardState.js'></script>
		<script>
			var LOOKSPEED = 0.03;
			var MOVESPEED = 0.05;
			var PLAYERSIZE = 0.2;
			var FOV = 70;
			
			window.addEventListener( 'resize', onWindowResize, false );
			
			function onWindowResize()
			{
				camera.aspect = game.offsetWidth/game.offsetHeight;
				camera.updateProjectionMatrix();
				
				renderer.setSize(game.offsetWidth, game.offsetHeight);

			}
			
			function de2ra(degree){ return degree*(Math.PI/180); }
			
			function addWall(x, y)
			{
				var cube = new THREE.Mesh(new THREE.CubeGeometry(1, 1, 1), wallMat);
				cube.position.set(x,0,y);
				scene.add(cube);
			}
			
			var game = document.getElementById("game");
			
			var scene = new THREE.Scene();
			scene.fog = new THREE.Fog(0x000000, 0.1, 10);
			var camera = new THREE.PerspectiveCamera(FOV, game.offsetWidth/game.offsetHeight, 0.01, 30);
			camera.position.set(2, 0.2, 2);
			var keyboard = new THREEx.KeyboardState();

			var renderer = new THREE.WebGLRenderer();
			renderer.setSize(game.offsetWidth, game.offsetHeight);
			game.appendChild(renderer.domElement);
			
			var wallTex = THREE.ImageUtils.loadTexture('./images/wall.png');
			wallTex.magFilter = THREE.NearestFilter;
			var wallMat = new THREE.MeshBasicMaterial({map: wallTex});
			
			var celingTexture = THREE.ImageUtils.loadTexture('./images/celing.png');
			celingTexture.magFilter = THREE.NearestFilter;
			celingTexture.wrapS = THREE.RepeatWrapping;
			celingTexture.wrapT = THREE.RepeatWrapping;
			celingTexture.repeat.set(35, 35);
			
			var floorTexture = THREE.ImageUtils.loadTexture('./images/floor.png');
			floorTexture.magFilter = THREE.NearestFilter;
			floorTexture.wrapS = THREE.RepeatWrapping;
			floorTexture.wrapT = THREE.RepeatWrapping;
			floorTexture.repeat.set(35, 35);
			
			var material2 = new THREE.MeshBasicMaterial({map: floorTexture});
			var plane = new THREE.Mesh(new THREE.PlaneGeometry(35, 35), material2);
			plane.position.set(0,-0.5,0);
			plane.rotation.x = de2ra(-90);
			scene.add(plane)
			
			var material3 = new THREE.MeshBasicMaterial({map: celingTexture});
			var plane2 = new THREE.Mesh(new THREE.PlaneGeometry(35, 35), material3);
			plane2.position.set(0,0.5,0);
			plane2.rotation.x = de2ra(90);
			scene.add(plane2)
			
			var material4 = new THREE.MeshBasicMaterial({color: 0xff0000});
			var plane3 = new THREE.Mesh(new THREE.PlaneGeometry(1, 1), material4);
			scene.add(plane3)
			
			var dungeon = 
				[[1,1,1,1,1],
				[1,0,0,0,1],
				[1,0,0,0,1],
				[1,0,0,0,1],
				[1,1,0,1,1],
				[1,0,0,0,1],
				[1,0,0,0,1],
				[1,0,0,0,1],
				[1,1,1,1,1]];
				
			for(var y = 0; y < dungeon.length; y++)
			{
				for(var x = 0; x < dungeon[0].length; x++)
				{
					if( dungeon[y][x] == 1 )
					{
						addWall(x, y);					
					}
				}
			}

			var render = function () {
				requestAnimationFrame(render);
				
				if( keyboard.pressed("Q") )
				{
					camera.rotation.y += LOOKSPEED;
				}
				if( keyboard.pressed("E") )
				{
					camera.rotation.y -= LOOKSPEED;
				}
				
				if( keyboard.pressed("W"))
				{
					camera.translateZ( -MOVESPEED-PLAYERSIZE );
					if(dungeon[Math.round(camera.position.z)][Math.round(camera.position.x)] == 1)
					{
						camera.translateZ( MOVESPEED + PLAYERSIZE );
					}
					else
					{
						camera.translateZ( PLAYERSIZE );
					}
				}
				if( keyboard.pressed("S"))
				{
					camera.translateZ( MOVESPEED+PLAYERSIZE );
					if(dungeon[Math.round(camera.position.z)][Math.round(camera.position.x)] == 1)
					{
						camera.translateZ( -MOVESPEED-PLAYERSIZE );
					}
					else
					{
						camera.translateZ( -PLAYERSIZE );
					}
				}
				if( keyboard.pressed("A"))
				{
					camera.translateX( -MOVESPEED -PLAYERSIZE );
					if(dungeon[Math.round(camera.position.z)][Math.round(camera.position.x)] == 1)
					{
						camera.translateX( MOVESPEED + PLAYERSIZE );
					}
					else
					{
						camera.translateX( PLAYERSIZE );
					}
				}
				if( keyboard.pressed("D"))
				{
					camera.translateX( MOVESPEED+PLAYERSIZE );
					if(dungeon[Math.round(camera.position.z)][Math.round(camera.position.x)] == 1)
					{
						camera.translateX( -MOVESPEED-PLAYERSIZE );
					}
					else
					{
						camera.translateX( -PLAYERSIZE );
					}
				}
				
				//console.log(dungeon[Math.round(camera.position.z)][Math.round(camera.position.x)]);
				
				plane.position.set(camera.position.x, -0.5, camera.position.z);
				plane2.position.set(camera.position.x, 0.5, camera.position.z);
				floorTexture.offset.x = camera.position.x;
				floorTexture.offset.y = -camera.position.z;
				celingTexture.offset.x = camera.position.x;
				celingTexture.offset.y = camera.position.z;
				
				renderer.render(scene, camera);
			};

			render();
		</script>
	</body>
</html>
